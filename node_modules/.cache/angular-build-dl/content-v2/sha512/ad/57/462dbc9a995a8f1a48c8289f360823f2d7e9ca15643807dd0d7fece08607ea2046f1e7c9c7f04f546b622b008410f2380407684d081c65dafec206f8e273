{"version":3,"sources":["src/app/pages/map/map.page.html","src/app/pages/map/map.module.ts","src/app/pages/map/map.page.scss","src/app/pages/map/map.page.ts"],"names":[],"mappings":"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","sourcesContent":["export default \"<ion-content>\\n    <script src=\\\"https://maps.googleapis.com/maps/api/js?key=AIzaSyCZ71jPdOF6e02nQmca2WrbJw_QeXZBh5Q\\\"></script>\\n    <div #map id=\\\"map\\\" style=\\\"height: 100%;width: 100%;overflow: auto;background-color: transparent;\\\"></div>\\n        <!-- fab placed to the top end -->\\n    <ion-fab vertical=\\\"top\\\" horizontal=\\\"end\\\" slot=\\\"fixed\\\">\\n        <ion-fab-button size=\\\"small\\\" color=\\\"danger\\\" (click)=\\\"click()\\\">\\n            <ion-icon name=\\\"alert\\\"></ion-icon>\\n        </ion-fab-button>\\n    </ion-fab>\\n</ion-content>\"","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { IonicModule } from '@ionic/angular';\nimport { FormsModule, ReactiveFormsModule} from '@angular/forms';\nimport { RouterModule } from '@angular/router';\nimport { Geolocation } from '@ionic-native/geolocation/ngx';\nimport { Device } from '@ionic-native/device/ngx';\nimport { MapPage } from './map.page';\nimport { Component, OnInit, ElementRef, ViewChild } from '@angular/core';\n\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    ReactiveFormsModule,\n    RouterModule.forChild([\n      {\n        path: '',\n        component: MapPage\n      }\n    ])\n  ],\n  declarations: [MapPage]\n})\nexport class MapPageModule {}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL3BhZ2VzL21hcC9tYXAucGFnZS5zY3NzIn0= */\"","import { Component, OnInit, ElementRef, ViewChild } from '@angular/core';\nimport { NavController } from '@ionic/angular';\nimport { Platform } from '@ionic/angular';\nimport { DatabaseService, User, Drive, VehicleTypes } from '../../services/database.service';\nimport { Chart } from \"chart.js\";\nimport { PipesModule } from '../../pipes/pipes.module';\nimport * as dayjs from 'dayjs';\nimport { ToastController } from '@ionic/angular';\nimport { Geolocation } from '@ionic-native/geolocation/ngx';\nimport { Device } from '@ionic-native/device/ngx';\nimport * as firebase from 'firebase';\ndeclare var google: any;\n\n@Component({\n  selector: 'app-map',\n  templateUrl:'./map.page.html',\n  styleUrls: ['./map.page.scss'],\n})\n\nexport class MapPage {\n\n  @ViewChild('map', {static: false}) mapElement: ElementRef;\n  map: any;\n  markers = [];\n  ref = firebase.database().ref('geolocations/');\n  drive;\n\n  constructor(public navCtrl: NavController,\n    public platform: Platform,\n    private geolocation: Geolocation,\n    public database: DatabaseService,\n    private device: Device) {\n    platform.ready().then(() => {\n      this.initMap();\n    });\n    this.ref.on('value', resp => {\n      this.deleteMarkers();\n      snapshotToArray(resp).forEach(data => {\n          let image = 'assets/car.png';\n          let updatelocation = new google.maps.LatLng(data.latitude,data.longitude);\n          this.addMarker(updatelocation,image);\n          this.setMapOnAll(this.map);\n      });\n    });\n  }\n\n  initMap() {\n    this.geolocation.getCurrentPosition({ maximumAge: 3000, timeout: 2500, enableHighAccuracy: true }).then((resp) => {\n    let mylocation = new google.maps.LatLng(parseFloat(resp.coords.latitude.toFixed(9)), parseFloat(resp.coords.longitude.toFixed(9)));\n    if ((parseFloat(resp.coords.latitude.toFixed(9)), parseFloat(resp.coords.longitude.toFixed(9))) != (this.database.current.user.location.lat, this.database.current.user.location.lng))\n    {\n      this.database.current.user.location = {lat: parseFloat(resp.coords.latitude.toFixed(9)),lng: parseFloat(resp.coords.longitude.toFixed(9))};\n      this.database.write('user', this.database.current.user.email, this.database.current.user);\n    }\n    this.map = new google.maps.Map(this.mapElement.nativeElement,\n    {\n        zoom: 15,\n        center: mylocation\n    });\n    });\n    let watch = this.geolocation.watchPosition();\n    watch.subscribe((data) => {\n      let updatelocation = new google.maps.LatLng(parseFloat(data.coords.latitude.toFixed(9)), parseFloat(data.coords.longitude.toFixed(9)));\n      if ((parseFloat(data.coords.latitude.toFixed(9)), parseFloat(data.coords.longitude.toFixed(9))) != (this.database.current.user.location.lat, this.database.current.user.location.lng))\n      {\n        this.database.current.user.location = {lat: parseFloat(data.coords.latitude.toFixed(9)),lng: parseFloat(data.coords.longitude.toFixed(9))};\n        console.log(this.database.current.user.location);\n        this.database.write('user', this.database.current.user.email, this.database.current.user);\n      }\n      this.deleteMarkers();\n      let image = 'assets/car.png';\n      this.addMarker(updatelocation,image);\n      this.setMapOnAll(this.map);\n      this.map.panTo(updatelocation);\n    });\n    var cloc = new google.maps.LatLng(this.database.current.user.location.lat, this.database.current.user.location.lng);\n    this.map.panTo(cloc);\n  }\n\n  addMarker(location, image) {\n    let marker = new google.maps.Marker({\n      position: location,\n      map: this.map,\n      icon: image\n    });\n    this.markers.push(marker);\n  }\n\n  setMapOnAll(map) {\n    for (var i = 0; i < this.markers.length; i++) {\n      this.markers[i].setMap(map);\n    }\n  }\n\n  clearMarkers() {\n    this.setMapOnAll(null);\n  }\n\n  deleteMarkers() {\n    this.clearMarkers();\n    this.markers = [];\n  }\n\n  public click(): void {\n    this.drive = this.getPendingDrives();\n    console.log(this.drive);\n    this.database.current.drive_to_edit = this.drive[0];\n    console.log(`> Navigating to AddDrivePage for drive id=${this.drive.id}`);\n    this.navCtrl.navigateForward(['/reportvehicle']);\n  }\n\n  public getPendingDrives() : Drive[] {\n    return this.database.current.drive_history.filter( (drive) => { if (this.database.current.user.email === drive.driver) {\n      return drive.status === 'in-progress';}\n    });\n  }\n\n}\n\nexport const snapshotToArray = snapshot => {\n    let returnArr = [];\n\n    snapshot.forEach(childSnapshot => {\n        let item = childSnapshot.val();\n        item.key = childSnapshot.key;\n        returnArr.push(item);\n    });\n\n    return returnArr;\n};\n\n"],"sourceRoot":"webpack:///","file":"pages-map-map-module-es5.js"}