{"version":3,"sources":["./src/app/pages/cmdmap/cmdmap.page.html","./src/app/pages/cmdmap/cmdmap.module.ts","./src/app/pages/cmdmap/cmdmap.page.scss","./src/app/pages/cmdmap/cmdmap.page.ts"],"names":[],"mappings":"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","file":"pages-cmdmap-cmdmap-module-es2015.js","sourcesContent":["export default \"<ion-content padding>\\n    <script src=\\\"https://maps.googleapis.com/maps/api/js?key=AIzaSyCZ71jPdOF6e02nQmca2WrbJw_QeXZBh5Q\\\"></script>\\n    <div #map id=\\\"cmdmap\\\" style=\\\"height: 100%;width: 100%;overflow: auto;background-color: transparent;\\\"></div>\\n</ion-content>\"","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { IonicModule } from '@ionic/angular';\nimport { FormsModule, ReactiveFormsModule} from '@angular/forms';\nimport { RouterModule } from '@angular/router';\nimport { Geolocation } from '@ionic-native/geolocation/ngx';\nimport { Device } from '@ionic-native/device/ngx';\nimport { CmdMapPage } from './cmdmap.page';\nimport { Component, OnInit, ElementRef, ViewChild } from '@angular/core';\n\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    ReactiveFormsModule,\n    RouterModule.forChild([\n      {\n        path: '',\n        component: CmdMapPage\n      }\n    ])\n  ],\n  declarations: [CmdMapPage]\n})\nexport class CmdMapPageModule {}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL3BhZ2VzL2NtZG1hcC9jbWRtYXAucGFnZS5zY3NzIn0= */\"","import { Component, OnInit, ElementRef, ViewChild } from '@angular/core';\nimport { NavController } from '@ionic/angular';\nimport { Platform } from '@ionic/angular';\nimport { DatabaseService, User, Drive, VehicleTypes } from '../../services/database.service';\nimport { Chart } from \"chart.js\";\nimport { PipesModule } from '../../pipes/pipes.module';\nimport * as dayjs from 'dayjs';\nimport { ToastController } from '@ionic/angular';\nimport { Geolocation } from '@ionic-native/geolocation/ngx';\nimport { Device } from '@ionic-native/device/ngx';\nimport * as firebase from 'firebase';\ndeclare var google: any;\n\n@Component({\n  selector: 'app-cmdmap',\n  templateUrl:'./cmdmap.page.html',\n  styleUrls: ['./cmdmap.page.scss'],\n})\n\nexport class CmdMapPage {\n\n  @ViewChild('cmdmap', {static: false}) mapElement: ElementRef;\n  map: any;\n  markers = [];\n  ;\n  ref = firebase.database().ref('geolocations/');\n\n  constructor(public navCtrl: NavController,\n    public platform: Platform,\n    private geolocation: Geolocation,\n    public database: DatabaseService,\n    private device: Device) {\n    platform.ready().then(() => {\n      this.initMap();\n    });\n    this.ref.on('value', resp => {\n      this.deleteMarkers();\n      snapshotToArray(resp).forEach(data => {\n          let image = 'assets/car.png';\n          let updatelocation = new google.maps.LatLng(data.latitude,data.longitude);\n          this.addMarker(updatelocation,image,this.database.current.user.name);\n      });\n    });\n  }\n\n  initMap() {\n    var c = 0;\n    var x = 0;\n    var y = 0\n    console.log(this.database.current.user);\n    this.geolocation.getCurrentPosition({ maximumAge: 3000, timeout: 2500, enableHighAccuracy: true }).then((resp) => {\n    let mylocation = new google.maps.LatLng(resp.coords.latitude,resp.coords.longitude);\n    this.database.current.user.location = {lat: resp.coords.latitude,lng: resp.coords.longitude};\n    this.database.write('user', this.database.current.user.email, this.database.current.user);\n    this.map = new google.maps.Map(this.mapElement.nativeElement, {\n      zoom: 15,\n      center: mylocation\n    });\n  });\n    for (var driver of this.database.current.all_drivers_of_commander){\n      var drvrloc = new google.maps.LatLng(driver.location.lat,driver.location.lng);\n      let image = 'assets/car.png';\n      this.addMarker(drvrloc, image, driver.name);\n      c += 1;\n      x += driver.location.lat;\n      y += driver.location.lng;\n    }\n    var midx = x / c;\n    var midy = y / c;\n    var midloc = new google.maps.LatLng(midx, midy);\n    this.map.panTo(midloc);\n  }\n\n  public addMarker(location, image, n) {\n    let marker = new google.maps.Marker({\n      position: location,\n      map: this.map,\n      icon: image,\n      label: n\n    });\n    this.markers.push(marker);\n  }\n\n  deleteMarkers() {\n    this.markers = [];\n  }\n\n  updateGeolocation(uuid, lat, lng) {\n    if(localStorage.getItem('mykey')) {\n      firebase.database().ref('geolocations/'+localStorage.getItem('mykey')).set({\n        uuid: uuid,\n        latitude: lat,\n        longitude : lng\n      });\n    } else {\n      let newData = this.ref.push();\n      newData.set({\n        uuid: uuid,\n        latitude: lat,\n        longitude: lng\n      });\n      localStorage.setItem('mykey', newData.key);\n    }\n  }\n\n}\n\nexport const snapshotToArray = snapshot => {\n    let returnArr = [];\n\n    snapshot.forEach(childSnapshot => {\n        let item = childSnapshot.val();\n        item.key = childSnapshot.key;\n        returnArr.push(item);\n    });\n\n    return returnArr;\n};"],"sourceRoot":"webpack:///"}