{"version":3,"sources":["./src/app/pages/map/map.page.html","./src/app/pages/map/map.module.ts","./src/app/pages/map/map.page.scss","./src/app/pages/map/map.page.ts"],"names":[],"mappings":"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","file":"pages-map-map-module-es2015.js","sourcesContent":["export default \"<ion-content>\\r\\n    <script src=\\\"https://maps.googleapis.com/maps/api/js?key=AIzaSyCZ71jPdOF6e02nQmca2WrbJw_QeXZBh5Q\\\"></script>\\r\\n    <div #map id=\\\"map\\\" style=\\\"height: 100%;width: 100%;overflow: auto;background-color: transparent;\\\"></div>\\r\\n        <!-- fab placed to the top end -->\\r\\n    <ion-fab vertical=\\\"top\\\" horizontal=\\\"end\\\" slot=\\\"fixed\\\">\\r\\n        <ion-fab-button size=\\\"small\\\" color=\\\"danger\\\" (click)=\\\"click()\\\">\\r\\n            <ion-icon name=\\\"alert\\\"></ion-icon>\\r\\n        </ion-fab-button>\\r\\n    </ion-fab>\\r\\n</ion-content>\"","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { FormsModule, ReactiveFormsModule} from '@angular/forms';\r\nimport { RouterModule } from '@angular/router';\r\nimport { Geolocation } from '@ionic-native/geolocation/ngx';\r\nimport { Device } from '@ionic-native/device/ngx';\r\nimport { MapPage } from './map.page';\r\nimport { Component, OnInit, ElementRef, ViewChild } from '@angular/core';\r\n\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    ReactiveFormsModule,\r\n    RouterModule.forChild([\r\n      {\r\n        path: '',\r\n        component: MapPage\r\n      }\r\n    ])\r\n  ],\r\n  declarations: [MapPage]\r\n})\r\nexport class MapPageModule {}\r\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL3BhZ2VzL21hcC9tYXAucGFnZS5zY3NzIn0= */\"","import { Component, OnInit, ElementRef, ViewChild } from '@angular/core';\r\nimport { NavController } from '@ionic/angular';\r\nimport { Platform } from '@ionic/angular';\r\nimport { DatabaseService, User, Drive, VehicleTypes } from '../../services/database.service';\r\nimport { Chart } from \"chart.js\";\r\nimport { PipesModule } from '../../pipes/pipes.module';\r\nimport * as dayjs from 'dayjs';\r\nimport { ToastController } from '@ionic/angular';\r\nimport { Geolocation } from '@ionic-native/geolocation/ngx';\r\nimport { Device } from '@ionic-native/device/ngx';\r\nimport * as firebase from 'firebase';\r\ndeclare var google: any;\r\n\r\n@Component({\r\n  selector: 'app-map',\r\n  templateUrl:'./map.page.html',\r\n  styleUrls: ['./map.page.scss'],\r\n})\r\n\r\nexport class MapPage {\r\n\r\n  @ViewChild('map', {static: false}) mapElement: ElementRef;\r\n  map: any;\r\n  markers = [];\r\n  ref = firebase.database().ref('geolocations/');\r\n  drive;\r\n\r\n  constructor(public navCtrl: NavController,\r\n    public platform: Platform,\r\n    private geolocation: Geolocation,\r\n    public database: DatabaseService,\r\n    private device: Device) {\r\n    platform.ready().then(() => {\r\n      this.initMap();\r\n    });\r\n    this.ref.on('value', resp => {\r\n      this.deleteMarkers();\r\n      snapshotToArray(resp).forEach(data => {\r\n          let image = 'assets/car.png';\r\n          let updatelocation = new google.maps.LatLng(data.latitude,data.longitude);\r\n          this.addMarker(updatelocation,image);\r\n          this.setMapOnAll(this.map);\r\n      });\r\n    });\r\n  }\r\n\r\n  initMap() {\r\n    this.geolocation.getCurrentPosition({ maximumAge: 3000, timeout: 2500, enableHighAccuracy: true }).then((resp) => {\r\n    let mylocation = new google.maps.LatLng(parseFloat(resp.coords.latitude.toFixed(9)), parseFloat(resp.coords.longitude.toFixed(9)));\r\n    if ((parseFloat(resp.coords.latitude.toFixed(9)), parseFloat(resp.coords.longitude.toFixed(9))) != (this.database.current.user.location.lat, this.database.current.user.location.lng))\r\n    {\r\n      this.database.current.user.location = {lat: parseFloat(resp.coords.latitude.toFixed(9)),lng: parseFloat(resp.coords.longitude.toFixed(9))};\r\n      this.database.write('user', this.database.current.user.email, this.database.current.user);\r\n    }\r\n    this.map = new google.maps.Map(this.mapElement.nativeElement,\r\n    {\r\n        zoom: 15,\r\n        center: mylocation\r\n    });\r\n    });\r\n    let watch = this.geolocation.watchPosition();\r\n    watch.subscribe((data) => {\r\n      let updatelocation = new google.maps.LatLng(parseFloat(data.coords.latitude.toFixed(9)), parseFloat(data.coords.longitude.toFixed(9)));\r\n      if ((parseFloat(data.coords.latitude.toFixed(9)), parseFloat(data.coords.longitude.toFixed(9))) != (this.database.current.user.location.lat, this.database.current.user.location.lng))\r\n      {\r\n        this.database.current.user.location = {lat: parseFloat(data.coords.latitude.toFixed(9)),lng: parseFloat(data.coords.longitude.toFixed(9))};\r\n        console.log(this.database.current.user.location);\r\n        this.database.write('user', this.database.current.user.email, this.database.current.user);\r\n      }\r\n      this.deleteMarkers();\r\n      if (this.map) {this.updatemap();}\r\n    });\r\n    if (this.map) {this.updatemap();}\r\n  }\r\n\r\n\r\n\r\n  addMarker(location, image) {\r\n    let marker = new google.maps.Marker({\r\n      position: location,\r\n      map: this.map,\r\n      icon: image\r\n    });\r\n    this.markers.push(marker);\r\n  }\r\n\r\n  public updatemap() {\r\n    let image = 'assets/car.png';\r\n    var updatelocation = new google.maps.LatLng(this.database.current.user.location.lat, this.database.current.user.location.lng);\r\n    this.addMarker(updatelocation,image);\r\n    this.setMapOnAll(this.map);\r\n    this.map.panTo(updatelocation);\r\n  }\r\n\r\n  setMapOnAll(map) {\r\n    for (var i = 0; i < this.markers.length; i++) {\r\n      this.markers[i].setMap(map);\r\n    }\r\n  }\r\n\r\n  clearMarkers() {\r\n    this.setMapOnAll(null);\r\n  }\r\n\r\n  deleteMarkers() {\r\n    this.clearMarkers();\r\n    this.markers = [];\r\n  }\r\n\r\n  public click(): void {\r\n    this.drive = this.getPendingDrives();\r\n    console.log(this.drive);\r\n    this.database.current.drive_to_edit = this.drive[0];\r\n    console.log(`> Navigating to AddDrivePage for drive id=${this.drive.id}`);\r\n    this.navCtrl.navigateForward(['/reportvehicle']);\r\n  }\r\n\r\n  public getPendingDrives() : Drive[] {\r\n    return this.database.current.drive_history.filter( (drive) => { if (this.database.current.user.email === drive.driver) {\r\n      return drive.status === 'in-progress';}\r\n    });\r\n  }\r\n}\r\n\r\nexport const snapshotToArray = snapshot => {\r\n    let returnArr = [];\r\n\r\n    snapshot.forEach(childSnapshot => {\r\n        let item = childSnapshot.val();\r\n        item.key = childSnapshot.key;\r\n        returnArr.push(item);\r\n    });\r\n\r\n    return returnArr;\r\n};"],"sourceRoot":"webpack:///"}